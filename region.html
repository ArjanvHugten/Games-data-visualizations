<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <link rel="shortcut icon" type="image/png" href="icon.png" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4"
    crossorigin="anonymous">
  <link href="styles/custom.css" rel="stylesheet">

  <title>Game sales</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://d3js.org/topojson.v1.min.js"></script>
  <script src="https://d3js.org/d3-queue.v3.min.js"></script>
</head>

<body>
  <nav class="navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Evolution of gaming</a>
  </nav>

  <div class="container-fluid">
    <div class="row">
      <nav class="col-md-2 d-none d-md-block bg-light sidebar">
        <div class="sidebar-sticky">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="index.html">
                <span data-feather="home"></span>
                Map
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="genres.html">
                <span data-feather="file"></span>
                Genre's
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="consoles.html">
                <span data-feather="file"></span>
                Consoles
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="publishers.html">
                <span data-feather="file"></span>
                Publishers
              </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="ratings.html">
                    <span data-feather="file"></span>
                    Ratings
                </a>
            </li>
          </ul>

          <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
            <span>Regions</span>
            <a class="d-flex align-items-center text-muted" href="#">
              <span data-feather="plus-circle"></span>
            </a>
          </h6>
          <ul class="nav flex-column mb-2">
            <li class="nav-item">
              <a class="nav-link" id="naLink" href="region.html?region=NA">
                <span data-feather="file-text"></span>
                North America
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="euLink" href="region.html?region=EU">
                <span data-feather="file-text"></span>
                Europe
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="jpLink" href="region.html?region=JP">
                <span data-feather="file-text"></span>
                Japan
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="otherLink" href="region.html?region=Other">
                <span data-feather="file-text"></span>
                Other
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          <h1 class="h2" id="title"></h1>
        </div>

        <svg id="svg_genres"></svg>
        <svg id="svg_consoles"></svg>
        <svg id="svg_publishers"></svg>

        <script>
          function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
              var pair = vars[i].split("=");
              if (pair[0] == variable) {
                return pair[1];
              }
            }
            alert('Query Variable ' + variable + ' not found');
          }

          var region = getQueryVariable("region");

          if (region == "NA") {
            document.getElementById("title").innerHTML = "North America";
            document.getElementById("naLink").classList.add("active");
          } else if (region == "EU") {
            document.getElementById("title").innerHTML = "Europe";
            document.getElementById("euLink").classList.add("active");
          } else if (region == "JP") {
            document.getElementById("title").innerHTML = "Japan";
            document.getElementById("jpLink").classList.add("active");
          } else {
            document.getElementById("title").innerHTML = "Other";
            document.getElementById("otherLink").classList.add("active");
          }
        </script>

        <script>
          (function () {
            var margin = { top: 20, right: 20, bottom: 70, left: 200 },
              width = 600 - margin.left - margin.right,
              height = 300 - margin.top - margin.bottom;

            var y = d3.scaleBand()
              .range([height, 0])
              .padding(0.1);

            var x = d3.scaleLinear()
              .range([0, width]);

            d3.csv("https://i344635.hera.fhict.nl/vgsales.csv").then(function (data) {
              var genres = {};
              var publishers = {};
              var consoles = {};

              data.forEach(function (d) {

                if (region == "NA") {
                  sales = d.NA_Sales;
                } else if (region == "EU") {
                  sales = d.EU_Sales;
                } else if (region == "JP") {
                  sales = d.JP_Sales;
                } else {
                  sales = d.Other_Sales;
                }

                if (genres[d.Genre] == null) {
                  genres[d.Genre] = 0;
                }
                genres[d.Genre] += parseFloat(sales) || 0;

                if (publishers[d.Publisher] == null) {
                  publishers[d.Publisher] = 0;
                }
                publishers[d.Publisher] += parseFloat(sales) || 0;

                if (consoles[d.Platform] == null) {
                  consoles[d.Platform] = 0;
                }
                consoles[d.Platform] += parseFloat(sales) || 0;

              });

              for (i = 1; i <= 3; i++) {

                var dictonary = null;
                if (i == 1) { dictonary = genres; svg3 = d3.select("#svg_genres"); }
                else if (i == 2) { dictonary = publishers; svg3 = d3.select("#svg_consoles"); }
                else { dictonary = consoles; svg3 = d3.select("#svg_publishers"); }

                var data = [];
                for (var index in dictonary) {
                  data.push({ index: index, sales: dictonary[index] });
                }


                data.sort((a, b) => (a.sales > b.sales) ? 1 : ((b.sales > a.sales) ? -1 : 0));
                data = data.slice(-10);

                x.domain([0, d3.max(data, function (d) {
                  return Number(d.sales);
                })]);
                y.domain(data.map(function (d) {
                  return d.index;
                }));


                var svg = svg3
                  .attr("width", width + margin.left + margin.right)
                  .attr("height", height + margin.top + margin.bottom)
                  .append("g")
                  .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

                // add the x Axis
                svg.append("g")
                  .attr("transform", "translate(0," + height + ")")
                  .call(d3.axisBottom(x));

                // text label for the x axis
                svg.append("text")             
                    .attr("transform",
                          "translate(" + (width/2) + " ," + 
                                        (height + margin.top + 20) + ")")
                    .style("text-anchor", "middle")
                    .text("Sales in millions");

                // add the y Axis
                svg.append("g")
                  .call(d3.axisLeft(y))

                // append the rectangles for the bar chart
                svg.selectAll(".bar")
                  .data(data)
                  .enter().append("rect")
                  .attr("class", "bar")
                  .attr("fill", "steelblue")
                  .attr("width", function (d) { return x(d.sales); })
                  .attr("y", function (d) { return y(d.index); })
                  .attr("height", y.bandwidth());
              }
            });
          })();   
        </script>
      </main>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
    crossorigin="anonymous"></script>
</body>

</html>